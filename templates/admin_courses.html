{% extends "base.html" %}

{% block title %}Course Management - Admin{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Course Management</h1>
    <div class="header-actions">
        <a href="{{ url_for('admin_create_course') }}" class="btn btn-success">
            <i class="fas fa-book-medical"></i> Create Course
        </a>
    </div>
</div>

<div class="table-container">
    <div class="table-actions">
        <div class="search-box">
            <input type="text" id="courseSearch" placeholder="Search courses...">
            <i class="fas fa-search"></i>
        </div>
        <div class="filter-box">
            <select id="statusFilter">
                <option value="">All Courses</option>
                <option value="active">Active Only</option>
                <option value="inactive">Inactive Only</option>
            </select>
        </div>
    </div>
    
    <table id="coursesTable">
        <thead>
            <tr>
                <th>Code</th>
                <th>Course Name</th>
                <th>Lecturer</th>
                <th>Semester</th>
                <th>Enrollment</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for course in courses %}
            <tr data-status="{{ 'active' if course.is_active else 'inactive' }}">
                <td>{{ course.code }}</td>
                <td>{{ course.name }}</td>
                <td>{{ course.lecturer.user.name }}</td>
                <td>{{ course.semester }}</td>
                <td>{{ course.students|length }}/{{ course.max_capacity }}</td>
                <td>
                    {% if course.is_active %}
                    <span class="status-badge status-active">
                        <i class="fas fa-check-circle"></i> Active
                    </span>
                    {% else %}
                    <span class="status-badge status-inactive">
                        <i class="fas fa-times-circle"></i> Inactive
                    </span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('admin_edit_course', course_id=course.id) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{{ url_for('admin_course_enrollments', course_id=course.id) }}" class="btn btn-info btn-sm">
                            <i class="fas fa-users"></i> Enrollments
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
// Search functionality
document.getElementById('courseSearch').addEventListener('keyup', function() {
    const searchTerm = this.value.toLowerCase();
    const filterStatus = document.getElementById('statusFilter').value;
    const rows = document.querySelectorAll('#coursesTable tbody tr');
    
    rows.forEach(row => {
        const code = row.cells[0].textContent.toLowerCase();
        const name = row.cells[1].textContent.toLowerCase();
        const lecturer = row.cells[2].textContent.toLowerCase();
        const semester = row.cells[3].textContent.toLowerCase();
        const status = row.dataset.status;
        
        const matchesSearch = code.includes(searchTerm) || 
                            name.includes(searchTerm) || 
                            lecturer.includes(searchTerm) ||
                            semester.includes(searchTerm);
        const matchesFilter = !filterStatus || status === filterStatus;
        
        row.style.display = matchesSearch && matchesFilter ? '' : 'none';
    });
});

document.getElementById('statusFilter').addEventListener('change', function() {
    document.getElementById('courseSearch').dispatchEvent(new Event('keyup'));
});
</script>
{% endblock %}